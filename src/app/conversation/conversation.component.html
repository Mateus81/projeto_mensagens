<div *ngIf="conversa && conversa.usuarioDest && currentUser && conversa.usuario" class="conversation-container">
    <h2>Conversando com {{ conversa.usuarioDest.id !== currentUser.id ? conversa.usuarioDest.nome : conversa.usuario.nome }}</h2>
    <div class="sem-mensagem" *ngIf="mensagens.length === 0">
      <p>Nenhuma mensagem disponível. ;-;</p>
    </div>
    <div *ngFor="let mensagem of mensagens" class="mensagem">
      <div class="mensagem-texto">
        <strong *ngIf="mensagem?.usuarioRemetente?.id === currentUser.id">Você:</strong>
        <strong *ngIf="mensagem?.usuarioRemetente?.id !== currentUser.id">{{ mensagem?.usuarioRemetente?.nome }}:</strong>
        <!--Se a mensagem estiver em modo de edição, seu texto é editável-->
        <textarea *ngIf="mensagem.editando" [(ngModel)]="mensagem.texto"></textarea>
        <!--Senão, ela é padrão-->
        <p *ngIf="mensagem.texto && !mensagem.editando">{{ mensagem.texto }}</p>
      </div>
      <div class="mensagem-acoes">
        <!--Se o destinatário estiver logado ele pode marcar mensagens recebidas como lidas-->
        <button *ngIf="mensagem.usuarioDestino?.id === currentUser?.id" (click)="marcaComoLida(mensagem.id!)" [disabled]="mensagem.vista">Marcar como lida</button>
        <button class="delete" *ngIf="mensagem.usuarioRemetente?.id === currentUser?.id && !mensagem.deletada"(click)="apagaMensagem(mensagem.id!)">Deletar</button>
        <button class="edit" *ngIf="mensagem.usuarioRemetente?.id === currentUser?.id && !mensagem.deletada"(click)="mensagem.editando ? salvaMensagemEditada(mensagem.id) : editaMensagem(mensagem)">
          {{mensagem.editando ? "Salvar" : "Editar"}}</button>
      </div>
    </div>

    <div class="nova-mensagem">
      <textarea [(ngModel)]="novaMensagem" placeholder="Digite sua mensagem"></textarea>
      <button (click)="enviarMensagem()">Enviar</button>
    </div>
    <!--Se o destinatário estiver logado ele pode marcar mensagens recebidas como lidas-->
    <div class="marca-todas-como-lida" *ngIf="conversa.usuarioDest?.id === currentUser?.id">
      <button (click)="marcaTodasComoLidas()">Marca mensagens como lidas</button>
    </div>

    <footer>
      <p>Retornar a lista de conversas?</p>
      <button (click)="voltarParaConversas()">Retornar</button>
      <br>
      <p>Retornar para contatos?</p>
      <button (click)="voltarParaContatos()">Retornar</button>
    </footer>
</div>
